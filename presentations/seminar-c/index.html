<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<title>Final Thesis Presentation | Andrew Wong</title>
<meta name=description content="Musings of a CSE Thesis">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="black-translucent">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<link rel=stylesheet href=../../reveal-js/css/reset.css>
<link rel=stylesheet href=../../reveal-js/css/reveal.css>
<link rel=stylesheet href=../../_.min.a230c4a7a1567dd6102968d8163a8141477da8488849428e390a8cd00a44c5a7.css id=theme><link rel=stylesheet href=../../highlight-js/default.min.css>
</head>
<body>
<div class=reveal>
<div class=slides>
<section data-noprocess data-shortcode-slide data-background-image=https://featherbear.cc/UNSW-CSE-Thesis/uploads/covers/0T4A9791.JPG data-transition=fade>
<p><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br></p>
<h3 id=smart-vacuum-cleaners>&ldquo;Smart&rdquo; Vacuum Cleaners</h3>
<h5 id=an-audit-into-the-security-and-integrity-of-iot-systems>An Audit Into The Security and Integrity of IoT Systems</h5>
<h6 id=andrew-wong--unsw-sydney>Andrew Wong | UNSW Sydney</h6>
</section><section>
<style>img[round]{border-radius:10px}</style>
<h1 id=todays-agenda>Today&rsquo;s Agenda</h1>
<ul>
<li>Topic recap</li>
<li>Thesis statement</li>
<li>Thesis A and B results</li>
<li>Where we left off (new progress)</li>
<li>Discussion</li>
<li>Conclusion</li>
</ul>
<aside class=notes><p>This presentation is hopefully less about the &lsquo;results&rsquo; but more addressing the question about security and privacy</p>
</aside>
</section><section>
<style>.marquee-parent{position:relative;width:100vw;max-width:100%;height:200px;overflow-x:hidden;border-radius:10px}.marquee-child{position:absolute;white-space:nowrap;will-change:transform;max-width:unset!important;max-height:100%!important;animation:marquee 360s linear infinite}.marquee-child:hover{animation-play-state:paused}@keyframes marquee{from{transform:translateX(0)}to{transform:translateX(-87.5%)}}</style>
<p><br></p>
<div class=marquee-parent><img src=../../uploads/20211115-lightbulbs-marquee.png class=marquee-child></div>
</br>
<section data-shortcode-section>
<p><em>&mldr;so there are a lot of IOT devices and IOT brands out there&mldr;</em></p>
<aside class=notes><p>Smart watches, smart washing machines, smart flip-flop shoes&mldr;</p>
</aside>
</section><section>
<p>üïµÔ∏è‚Äç‚ôÇÔ∏è Are competing products looking suspiciously similar to you?<br>
Most are <u>white-labelled</u> products, the biggest ecosystem vendor being <span style=display:inline-table;vertical-align:middle><img src=../../uploads/tuya_logo.png height=40px alt=Tuya></span></p>
<p><label>Pros</label></p>
<p>üë®‚Äçüíª Use someone else&rsquo;s code<br>
üíπ Fast profit turnaround</p>
<p><label>Cons</label></p>
<p>‚ö†Ô∏è Use someone else&rsquo;s code<br>
üîì Potentially security vulnerabilities</p>
<aside class=notes><p>FYI not here to tell you whether or not IOT devices are good or not&mldr; that&rsquo;s for you to judge. My research is on whether these big players have been doing their part (as providers) to keep us safe</p>
</aside>
</section><section>
<p>IOT ecosystems often have a centralised system to manage their fleet <span style=font-size:18px> (devices)</span>.</p>
<p><label>Pros</label></p>
<p>A centralised management is <u><i>so</i></u> much simpler/easier/faster/cheaper/&lsquo;better&rsquo; than a decentralised one.</p>
<p><label>Cons</label></p>
<p>‚ö†Ô∏è Device functionality dependent on system availability<br>
‚ö†Ô∏è Little transparency about what/where/when/why data is transmitted</p>
<aside class=notes><p>Remotely issue firmware updates, commands, send logs, monitor network stability, etcetera</p>
</aside>
</section>
</section><section>
<h1 id=statement>Statement</h1>
<section data-shortcode-section>
<blockquote>
</blockquote>
<div>
How have manufacturers of IoT / smart home devices addressed the increasing concerns of digital privacy and product security?
<div style=text-align:right;font-size:20px>(Specifically Roborock)</span>
</div>
<blockquote>
</blockquote>
<p><br>
<br></p>
<ul>
<li>Digital Privacy
<ul>
<li>Investigate the nature of network data</li>
<li>i.e. content, frequency, destination, usage</li>
</ul>
</li>
<li>Product Security
<ul>
<li>Investigate security vulnerabilities</li>
<li>Assess the effectiveness of security fortifications</li>
</ul>
</li>
</ul>
</section><section>
<div style=display:flex;flex-direction:row>
<div>
Device in scope: <label>Roborock S6</label> (2019)
<p>A smart vacuum cleaner, with integrations to both <span style=display:inline-table;vertical-align:middle><img src=../../uploads/tuya_logo.png height=40px alt=Tuya></span> and <span style=display:inline-table;vertical-align:middle><img src=../../uploads/xiaomi_smartlife_logo.webp height=40px alt="Mijia (Xiaomi)"></span> (depending on model)</p>
</div>
<img src=../../uploads/20211103-s6-pure-banner.webp width=500px>
</div>
<p>¬†</p>
<blockquote>
<p>It works pretty well, according to reviews.<br>
But is it safe to connect to your home?</p>
</blockquote>
<aside class=notes><p>Roborock was first tasked by Xiaomi to develop their vacuum cleaner (Mi Robot Vacuum Cleaner) in 2017 - they have since become their own company, developing their own line of vacuum cleaners</p>
</aside>
</section>
</section><section>
<section data-shortcode-section>
<p><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br></p>
<h1 id=thesis-a--results>Thesis A | Results</h1>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<p>Thesis A - Disassembled the device (many, many screws)</p>
<p><a href="https://www.youtube.com/watch?v=MnvvZbCDcA8"><img round src=../../uploads/20211030_040050.jpg></a></p>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<p>Thesis A - Found the UART pins and got some terminal</p>
<iframe style="border:2px solid #fff;border-radius:10px;pointer-events:none" width=1280 height=720 src=../seminar-a/?noControls#/19/5></iframe>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<p>Thesis A - Got root access (Device runs Ubuntu 14.04.3 LTS)</p>
<iframe style="border:2px solid #fff;border-radius:10px;pointer-events:none" width=1280 height=720 src=../seminar-a/?noControls#/19/7></iframe>
</section>
</section><section>
<section data-shortcode-section>
<p><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br></p>
<h1 id=thesis-b--results>Thesis B | Results</h1>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<p>Thesis B - Firmware dump (<code>dd</code>) for offline/static analysis</p>
<p><a href=../posts/20220302-progress/#backup><img round src=../../uploads/20220501-0T4A9824.JPG></a></p>
<aside class=notes><p>Could have dumped with a flash dumper but I don&rsquo;t own one of those!<br>
This does mean I only have access to the eMMC rather than being able to dump the firmware of the STM or other chips on the motherboard&mldr; but it&rsquo;s probably enough.</p>
<p>Plus also if there&rsquo;s a firmware update to those chips, I could just look at that.</p>
</aside>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<p>Thesis B - Inspection of system (privileged processes)</p>
<iframe style="border:2px solid #fff;border-radius:10px;pointer-events:none" width=1280 height=720 src=../seminar-b/?noControls#/7/2></iframe>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<p>Thesis B - Recovery partition manipulation (see <a href="https://www.youtube.com/watch?v=eABmzUfZ22A">proof of concept</a>)</p>
<iframe style="border:2px solid #fff;border-radius:10px;pointer-events:none" width=1280 height=720 src=../seminar-b/?noControls#/12/3></iframe>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<p>Thesis B - Capture of device traffic (port-mirroring)</p>
<iframe style="border:2px solid #fff;border-radius:10px;pointer-events:none" width=1280 height=720 src=../seminar-b/?noControls#/6></iframe>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<p>Thesis B - Inspection of system services (<code>netstat</code>, <code>ip{,6}tables</code>)</p>
<iframe style="border:2px solid #fff;border-radius:10px;pointer-events:none" width=1280 height=720 src=../seminar-b/?noControls#/7/3></iframe>
<aside class=notes><p>Note that there is a firewall rule - though certain programs were able to unblock the port</p>
</aside>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<p>Thesis B - Remote access persistence (see <a href="https://www.youtube.com/watch?v=om2yzYHU1A0">proof of concept</a>)</p>
<iframe style="border:2px solid #fff;border-radius:10px;pointer-events:none" width=1280 height=720 src=../seminar-b/?noControls#/8></iframe>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<p>Thesis B - Investigating <code>tcpdump</code></p>
<iframe style="border:2px solid #fff;border-radius:10px;pointer-events:none" width=1280 height=720 src=../seminar-b/?noControls#/11/4></iframe>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<p>Thesis B - Investigating <code>rrlogd</code></p>
<iframe style="border:2px solid #fff;border-radius:10px;pointer-events:none" width=1280 height=720 src=../seminar-b/?noControls#/11/6></iframe>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<p>Thesis B - Investigating <code>adbd</code></p>
<iframe style="border:2px solid #fff;border-radius:10px;pointer-events:none" width=1280 height=720 src=../seminar-b/?noControls#/11/8></iframe>
</section>
</section><section>
<section data-shortcode-section>
<p><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br></p>
<h1 id=where-we-left-off>Where we left off</h1>
</section><section>
<h2 id=from-thesis-b-security>From Thesis B (security)</h2>
<ul>
<li>Finish analysing firmware binaries</li>
<li>Comparing files against the stock Ubuntu OS</li>
<li>Check if an IPv6 address is assigned (hence SSH)
<ul>
<li>ans: <a href=../../posts/ipv6-check/>no.</a></li>
</ul>
</li>
</ul>
<h2 id=from-thesis-c-privacy>From Thesis C (privacy)</h2>
<ul>
<li>LAN/WAN traffic analysis
<ul>
<li>Look at network behaviour</li>
<li>Hook into transmit and receive functions (pre-encrypt / post-decrypt)</li>
</ul>
</li>
<li>Update to latest version <span style=font-size:18px>(and hope we don&rsquo;t get locked out)</span>
<ul>
<li><span style=color:grey;font-size:18px>disclaimer: we got locked out. hahah&mldr;.</span></li>
<li>Compare file changes</li>
</ul>
</li>
<li>Factory reset device, check for remnant files</li>
</ul>
</section>
</section><section>
<h1 id=more-on-adbd>More on <code>adbd</code></h1>
<p><small>A novel but not-so-useful way to perform arbitrary code execution</small></p>
<section data-shortcode-section>
<p>Command injection vulnerability exists within the modified <code>adbd</code> binary</p>
<p><img src=../../uploads/20220725-snipaste_2022-07-26_04-02-13.jpg alt></p>
</section><section>
<h2 id=whats-modified>What&rsquo;s modified?</h2>
<ul>
<li>Interface to perform <code>uart_test</code> and <code>ruby_flash</code></li>
<li>Authenticated access to <code>adb shell</code>
<ul>
<li>Dynamic challenge/response</li>
<li>Requires knowledge of <code>vinda</code>, device ID</li>
</ul>
</li>
</ul>
<p><img src=../../uploads/20220725-snipaste_2022-07-25_23-49-57.jpg alt></p>
</section><section>
<h2 id=auth-flow>Auth Flow</h2>
<pre><code>SYS_PASSWD = /mnt/default/vinda := ABCD1234ABCD1234

# Get challenge
CHALLENGE $= adb shell [SYS_PASSWD]rockrobo dynamickey

# Generate response
ADB_PASSWD = generate(challenge, device_id)

# Perform command
adb shell [SYS_PASSWD][ADB_PASSWD] [COMMAND*]
</code></pre>
</section><section>
<h2 id=achieving-rce>Achieving RCE</h2>
<ul>
<li>The modified binary has some sort of access level implementation
<ul>
<li>Depends on value in <code>/mnt/default/adb.conf</code> (RO)</li>
</ul>
</li>
</ul>
<blockquote>
</blockquote>
<ul>
<li>Arbitrary command execution when access level = 0
<ul>
<li>But the app also resets this value to 1</li>
<li><code>&</code>, <code>;</code>, <code>|</code>, <code>`</code> characters are also forbidden</li>
</ul>
</li>
</ul>
<blockquote>
</blockquote>
<p>üò¢ No arbitrary command execution&mldr;</p>
<pre><code class=language-bash>$&gt; py -3 adbStart &quot;whoami&quot;

src/rr_ruby.c::adb_check_unlock_level1():not support /adb shell sys_passwd#adb_passwd whoami in level 1
</code></pre>
</section><section>
<h2 id=noooooooooo-span-stylefont-size-18pxwait-whatspan>Noooooooooo <span style=font-size:18px>wait what</span></h2>
<p><img src=../../uploads/Snipaste_2022-07-26_05-53-34.jpg alt></p>
<p>&mldr; where did <code>/bin/sh</code> come from..?</p>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<h2 id=rce-via-command-substitution>RCE via command substitution</h2>
<p><img src=../../uploads/20220725-snipaste_2022-07-26_03-56-14.jpg alt></p>
<p>Avoiding the forbidden characters (<code>&</code>, <code>;</code>, <code>|</code>, <code>`</code>) we can exploit command substitution and redirections to inject commands.</p>
<blockquote>
<p>Allows us to write to the filesystem</p>
</blockquote>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<h2 id=rce-via-command-substitution-1>RCE via command substitution</h2>
<blockquote>
<p>Or read from the filesystem too!</p>
</blockquote>
<p><img src=../../uploads/20220725-snipaste_2022-07-26_04-02-13.jpg alt></p>
</section><section>
<h2 id=poc-breakdown-span-stylefont-size-18pxwhere-it-falls-apartspan>POC breakdown <span style=font-size:18px>(Where it falls apart)</span></h2>
<ul>
<li>Still need to authenticate before RCE possible
<ul>
<li>Still need knowledge of the <code>/mnt/default/vinda</code> file</li>
<li>Need to physically open the device at least once
<ul>
<li>Screws. Lots of them.</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
</blockquote>
<ul>
<li>At least, provides a way to issue commands even when <code>adb_lock != 0</code>
<ul>
<li>USB protocol is more common and accessible to people</li>
<li>SSH access might stop working / be blocked <span style=color:grey;font-size:12px>(spoilers)</span> </li>
<li>Serial access might stop working / be blocked <span style=color:grey;font-size:12px>(spoilers)</span> </li>
</ul>
</li>
</ul>
</section>
</section><section>
<aside class=notes><p>Now that we&rsquo;re throwing in a new firmware version, or a few new versions actually&mldr;<br>
What&rsquo;s the best way to explore these?</p>
<p>All of firmware A, then all of firmware B, then all of firmware C?</p>
<p>Or topic 1, firmware A and B and C
then topic 2, firmware A and B and C</p>
<p>The second idea is probably better - as we should be focussing on the <em>changes</em> (i.e. efforts that the company has done) between firmware version</p>
</aside>
<h1 id=firmware-comparison>Firmware Comparison</h1>
<section data-shortcode-section>
<pre><code class=language-bash>$&gt; cat /etc/OS_VERSION
ro.product.device=MI1558_TANOS_MP_S2020032500REL_M3.3.0_RELEASE_20200325-204847
$&gt; #              ^^^^^^           ^^^^^^^^
$&gt; #              \/\\//           \\\\////
$&gt; #          Xiaomi v01.15.58  25th March 2020
$&gt; #                                      
</code></pre>
<p><label>Aside</label></p>
<ul>
<li>The Roborock S6 was released in June 2019</li>
<li>The unit I have was manufactured June 2020
<ul>
<li>My unit has a newer base firmware (25th March 2020)</li>
</ul>
</li>
<li>Note the presence of &ldquo;<label>MI</label>&rdquo; at the start of the product string</li>
</ul>
</section><section>
<h2 id=stock-ubuntu-14043-lts>Stock Ubuntu 14.04.3 LTS</h2>
<p>Performed a <code>diff</code> check against the <a href=http://cdimage.ubuntu.com/ubuntu-base/releases/14.04/release/ubuntu-base-14.04.3-core-armhf.tar.gz>Ubuntu 14.04.3 Core LTS (armhf)</a> OS.</p>
<blockquote>
</blockquote>
<ul>
<li>All binaries present on the device matched, <i>except</i> for <code>ntpdate</code> (synchronise computer time via NTP)</li>
<li>Still functionally equivalent</li>
</ul>
<p><img src=../../uploads/20220724-snipaste_2022-06-29_02-32-15.jpg alt></p>
</section><section>
<h2 id=a-new-firmware>A new firmware</h2>
<pre><code class=language-diff>-ro.product.device=MI1558_TANOS_MP_S2020032500REL_M3.3.0_RELEASE_20200325-204847
+ro.product.device=TANOS_V2902-2022042802REL_M3.5.8_T4.1.4-2_RELEASE_20220428-202811
-ro.build.display.id=TANOS_MP_R16_RELEASE_20200325-204847
+ro.build.display.id=TANOS_MP_R16_RELEASE_20220428-202811
 ro.sys.cputype=R16.STM32.A3.G1
-ro.build.version.release=1558
+ro.build.version.release=V2902
-ro.build.date.utc=1585140527
+ro.build.date.utc=1651148891
</code></pre>
<p>The update process performed several incremental updates..<br>
finally updating to <label>v02.29.02</label> (28th April 2022)</p>
</section><section>
<h2 id=the-official-changelog>The Official Changelog</h2>
<pre><code>&gt; 01.17.08 (17th April 2020)
- Supports multi-floor map saving and robot knows which floor it is
- Update to new structured SLAM algorithm to make map more reliable
- Support customised room cleaning sequence
- Support no-mop zone

&gt; 01.19.98 (9th June 2020)
* Improvised Wi-Fi Easy Connect
* overall improvements
* bug fixes
* UX fixes

&gt; 01.20.76 (23rd June 2020)
* Obstacle avoidance enhancements
* Bug fixes and UI optimisation

&gt; probably more updates (got locked out)

&gt; 02.29.02 (28th April 2022)
* Optimized the quick mapping experience
</code></pre>
</section>
<section data-noprocess data-shortcode-slide data-transition=fade>
<h2 id=the-changelog-i-actually-care-about>The Changelog I Actually Care About</h2>
<pre><code>&gt; 01.17.08 (17th April 2020)
* /opt/rockrobo/watchdog/WatchDoge iptables drop SSH
* /opt/rockrobo/rrlog/rrlogd iptables drop SSH
* Utilities change to busybox
* SSH server changed to dropbear
* /opt/rockrobo/rriot/rriot_rr added (but not enabled)

&gt; 01.19.98 (9th June 2020)
* Serial handler changed to /sbin/rr_login

&gt; 01.20.76 (23rd June 2020)
-

&gt; probably more updates (got locked out)

&gt; 02.29.02 (28th April 2022)
* /opt/rockrobo/rriot/rriot_rr enabled
</code></pre>
</section><section>
<h2 id=getting-locked-out---rr_login>Getting locked out - <code>rr_login</code></h2>
<pre><code class=language-md data-line-numbers=5>...
* /opt/rockrobo/rriot/rriot_rr added (but not enabled)

&gt; 01.19.98 (9th June 2020)
* Serial handler changed to /sbin/rr_login

&gt; 01.20.76 (23rd June 2020)
-
...
</code></pre>
<p>After the <label>v01.19.98</label> update, serial shell access was denied, uh oh!</p>
<aside class=notes><p>Did the password change?<br>
Did I break something?<br>
Is this the end?</p>
</aside>
</section><section>
<h2 id=lockdown-shell>Lockdown: Shell</h2>
<ul>
<li>Serial handler no longer uses <code>getty</code>
<ul>
<li>Now uses modified version called <a href=posts/sbin-rr_login/><code>rr_login</code></a></li>
</ul>
</li>
<li>OpenSSH server was replaced with modified version of <code>dropbear</code></li>
</ul>
<blockquote>
</blockquote>
<p>Both only allow login as the <code>root</code> user</p>
<p><img src=../../uploads/20220711-snipaste_2022-07-12_00-28-13.jpg alt></p>
<aside class=notes><p>Serial handler is responsible for giving us the UART shell interface)</p>
</aside>
</section><section>
<h2 id=lockdown-authentication>Lockdown: Authentication</h2>
<p>The <code>vinda</code> file is no longer used for auth!</p>
<blockquote>
</blockquote>
<p>Login attempts now verify against</p>
<ul>
<li><code>[mmcblk0p6]/shadow</code></li>
<li><code>[mmcblk0p6]/shadow.sign</code>.</li>
</ul>
<blockquote>
<p>But these files don&rsquo;t exist on my device&mldr;</p>
</blockquote>
<p>Affected: <code>rr_login</code> (serial), <code>dropbear</code> (SSH), <code>adbd</code>? (USB)</p>
<aside class=notes><p>Confirmed by checking against strace / gdb / static analysis (BinaryNinja)</p>
</aside>
<p><small><label>Fix</label><br>
<a href=../posts/upgraded-accessing-the-shell/>(1)</a> Enter bootloader and force entrypoint to a shell<br>
<a href=../posts/upgrade-notes/#notice>(2)</a> Patch <code>/etc/inittab</code> to revert back to a normal login shell</small></p>
</section><section>
<h2 id=lockdown-authentication-span-stylefont-size-24pxverify_shadowspan>Lockdown: Authentication <span style=font-size:24px>(<code>verify_shadow</code>)</span></h2>
<p><img src=../../uploads/20220719-snipaste_2022-07-19_22-51-42.jpg alt></p>
</section><section>
<h2 id=lockdown-authentication-span-stylefont-size-24pxssh-auth-attempt-trace-with-stracespan>Lockdown: Authentication <span style=font-size:24px>(SSH auth attempt trace with <code>strace</code>)</span></h2>
<p><img src=../../uploads/20220719-snipaste_2022-07-19_22-24-51.jpg alt></p>
</section><section>
<h2 id=system-changes>System Changes</h2>
<ul>
<li>Are we still using Ubuntu?
<ul>
<li>Maybe? </li>
<li><code>apt-get</code> and <code>dpkg</code> removed</li>
</ul>
</li>
<li>Lots of tools were replaced with BusyBox (v1.24.1)
<ul>
<li>Also a space-saving measure</li>
<li><img src=../../uploads/20220724-snipaste_2022-07-25_02-50-06.jpg alt></li>
</ul>
</li>
<li>Effectively now running embedded Linux</li>
</ul>
<p><small><a href=https://github.com/featherbear/UNSW-CSE-Thesis/blob/master/firmwares/updating/v02.29.02_diff_v01.15.58.diff>Download git diff</a></small></p>
</section><section>
<h2 id=lockdown-firewall>Lockdown: Firewall</h2>
<ul>
<li>There are now <code>ip6tables</code> rules to drop all packets üëè
<ul>
<li>Apps also no longer perform IPv6 (AAAA) DNS requests </li>
</ul>
</li>
</ul>
<blockquote>
</blockquote>
<ul>
<li>Processes have calls to reinstate dropping SSH access
<ul>
<li><code>rrlogd</code> now drops access on bad version match
<ul>
<li>(previously <em>only</em> allowed access on correct version match)</li>
</ul>
</li>
<li><code>WatchDoge</code> immediately drops access on start</li>
</ul>
</li>
</ul>
<p>¬†</p>
<div style=text-align:center>
<img src=../../uploads/20220711-snipaste_2022-07-12_01-25-43.jpg width=60%>
</div>
</section><section>
<h2 id=rrlogd-and-wlanmgr><code>rrlogd</code> and <code>wlanmgr</code></h2>
<p><code>wlanmgr</code> now has the functionality to call <code>tcpdump</code></p>
<blockquote>
</blockquote>
<p><code>rrlogd</code> will upload the following</p>
<table>
<thead>
<tr>
<th style=text-align:center>Content</th>
<th style=text-align:left>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center><code>/etc/resolv.conf</code></td>
<td style=text-align:left>DNS resolvers</td>
</tr>
<tr>
<td style=text-align:center><code>netstat -anp</code></td>
<td style=text-align:left>All sockets and their PIDs</td>
</tr>
<tr>
<td style=text-align:center><code>ifconfig</code></td>
<td style=text-align:left>Network interface status</td>
</tr>
<tr>
<td style=text-align:center>PCAP</td>
<td style=text-align:left>Packet capture</td>
</tr>
</tbody>
</table>
</section>
</section><section>
<h1 id=what-else-is-uploaded-rrlogd>What else is uploaded (<code>rrlogd</code>)?</h1>
<section data-shortcode-section>
<blockquote>
<p>What can the manufacturer see?</p>
</blockquote>
<ul>
<li>Device data</li>
<li>Application config</li>
<li>Application logs</li>
<li>SLAM (map)</li>
<li>Running processes</li>
<li>Wireless configuration</li>
<li>Packet capture</li>
<li>Blackbox (statistics)</li>
</ul>
<blockquote>
<p>See: <a href=../posts/privacy-policy-from-apk/>Privacy Policy</a></p>
</blockquote>
<aside class=notes><p>It inadvertently uploads the device&rsquo;s wireless network credentials (because of app logs), though there is realistically no need for the manufacturer to know this.</p>
<p>Also - the device can&rsquo;t connect without being connected to a wireless network with an internet connection. So the reason of &lsquo;troubleshooting connectivity issues&rsquo; is rather moot.</p>
</aside>
</section><section>
<pre><code class=language-md>Effective: 30th April 2019

Cleaning-related information ... last 20 items will be saved by your device and server...
...stored in the server for up to 180 days, ... automatically deleted after expiration.
Network information: ...the password information is only stored on the device side...
... will not be uploaded to the server.
Timing information... Cleanable Area Information... Other information: For example, ....
</code></pre>
<p>&ldquo;Password [&mldr;] only stored on the device&rdquo; - <label>Well about that&mldr;</label></p>
<div style=text-align:center>
<div><img round src=../../uploads/Snipaste_2022-07-28_07-11-20.png width=60%></div>
<small>Above: Log data uploaded by <code>rrlogd</code> | FW: v02.29.02 (28th April 2022)</small>
</div>
<aside class=notes><p>Also like&mldr; &ldquo;Other information&rdquo; is rather bleak&mldr;</p>
</aside>
</section>
</section><section>
<h1 id=file-persistence-span-stylefont-size-24pxupgrade-and-resetspan>File Persistence <span style=font-size:24px>(Upgrade and Reset)</span></h1>
<p>Test untouched directories during a <a href=../posts/upgrade-upgrade-persistence/>firmware update</a> and <a href=../posts/upgrade-reset-persistence>factory reset</a></p>
<blockquote>
</blockquote>
<section data-shortcode-section>
<div style=display:flex;flex-direction:row>
<div>
<label>Upgrade Persistent</label>
<ul>
<li>[mmcblk0p11] @ <code>/mnt/reserve</code></li>
<li>[mmcblk0p1] @ <code>/mnt/data</code></li>
</ul>
</div>
<div>
<label>Reset Persistent</label>
<ul>
<li>[mmcblk0p11] @ <code>/mnt/reserve</code></li>
</ul>
</div>
</div>
<p>¬†<br>
¬†<br>
¬†</p>
<blockquote>
</blockquote>
<table>
<thead>
<tr>
<th style=text-align:center>Partition</th>
<th style=text-align:left>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center><code>mmcblk0p1</code></td>
<td style=text-align:left>Device registration, WiFi, map data, logs</td>
</tr>
<tr>
<td style=text-align:center><code>mmcblk0p11</code></td>
<td style=text-align:left>Statistics, calibration data</td>
</tr>
</tbody>
</table>
</section><section>
<ul>
<li>Map, log and user data is cleared (securely)</li>
<li>Reserve partition is never cleared, even during factory resets</li>
</ul>
<pre><code>mmcblk0p11
|   mcu_ready
|   try
|   hwinfo
|   anonymousid1
|   lds_calibration.txt
|   counter
|   CompassBumper.cfg
|   blackbox.db
|   rrBkBox.csv
|   endpoint.bin
|   RoboController.cfg
|   last_partition
|
\---rriot
        tuya.json
</code></pre>
<aside class=notes><ul>
<li>Can&rsquo;t perform byte-level recovery (e.g. photorec) due to reset method</li>
<li>Can&rsquo;t completely disassociate yourself from the previous owner</li>
<li>Possible to forge symbolic links?</li>
</ul>
</aside>
</section>
</section><section>
<h1 id=file-persistence-span-stylefont-size-24pxaccount-disassociationspan>File Persistence <span style=font-size:24px>(Account disassociation)</span></h1>
<p>‚ö†Ô∏è All files kept between disassociations</p>
<ul>
<li>Roborock should make the device reset itself automatically
<ul>
<li>They probably don&rsquo;t because they assume you will reconnect</li>
</ul>
</li>
</ul>
<blockquote>
</blockquote>
<ul>
<li>Selling your device?
<ul>
<li>Do a factory reset</li>
<li>&mldr;or don&rsquo;t.</li>
</ul>
</li>
<li>Buying a new device?
<ul>
<li>Do a factory reset (and hope it&rsquo;s not modified)</li>
</ul>
</li>
</ul>
</section><section>
<h1 id=network-inspection>Network Inspection</h1>
<section data-shortcode-section>
<p><label>Setup</label></p>
<ul>
<li>Isolated sandbox network
<ul>
<li>Router, switch, access point, Vacuum Cleaner</li>
<li>Additional NUC to simulate peer data</li>
</ul>
</li>
<li>Captured packets (unattended) for a month</li>
<li>Captured packets (interactive) for several sessions</li>
<li>Filter out network noise</li>
<li>Compare network activity between old and new firmware</li>
</ul>
<div style=text-align:center>
<img round src=../../uploads/Snipaste_2022-05-05_01-31-27.jpg width=65%>
</div>
</section><section>
<h2 id=network-behaviour-span-stylefont-size-24pxfw-v022902-exc-fds-1-weekspan>Network Behaviour <span style=font-size:24px>(FW v02.29.02) (exc FDS) (1 week)</span></h2>
<div style=text-align:center>
<img round src=../../uploads/20220724-snipaste_2022-07-25_07-41-15.jpg width=60%>
</div>
<table>
<thead>
<tr>
<th style=text-align:left>Endpoint</th>
<th style=text-align:center>Protocol</th>
<th style=text-align:left>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left><code>m2.tuyaeu.com</code></td>
<td style=text-align:center>MQTT</td>
<td style=text-align:left>Inbound requests</td>
</tr>
<tr>
<td style=text-align:left><code>a2.tuyaeu.com</code></td>
<td style=text-align:center>HTTPS</td>
<td style=text-align:left>Outbound requests</td>
</tr>
<tr>
<td style=text-align:left><code>awsde0.fds.api.xiaomi.com</code></td>
<td style=text-align:center><a href=http://docs.api.xiaomi.com/en/fds/>FDS</a></td>
<td style=text-align:left>Logs upload</td>
</tr>
</tbody>
</table>
</section><section>
<h2 id=network-geomap-span-stylefont-size-24pxfw-v022902-exc-fds-1-weekspan>Network Geomap <span style=font-size:24px>(FW v02.29.02) (exc FDS) (1 week)</span></h2>
<p><img src=../../uploads/20220724-m2-a2-geomap.png alt></p>
</section><section>
<h2 id=observations>Observations</h2>
<ul>
<li>Local traffic - DHCP (5min), Tuya Discovery (5s)</li>
<li>Connections to America, Germany, China
<ul>
<li>America, Germany - AWS - <code>fds</code>, <code>a2</code>, <code>ms</code>, <code>m2</code></li>
<li><span style=color:grey>China - Mi IO Cloud (v01.15.58 only)</span></li>
</ul>
</li>
<li>Increased network activity at 3am
<ul>
<li>3am AEDT is 12am in Beijing</li>
<li>Connections are being established - possible timeout/reconnect</li>
</ul>
</li>
</ul>
<h2 id=changes>Changes</h2>
<ul>
<li>New FW uses <code>m2.tuyaeu.com</code> instead of <code>ms.tuyaeu.com</code></li>
<li>New FW no longer polls <code>xx.ot[t].io.mi.com</code></li>
</ul>
</section><section>
<h2 id=whats-in-the-packet>What&rsquo;s in the packet?</h2>
<blockquote>
<p>Most (if not all) communications were encrypted</p>
</blockquote>
<p><s>1. Break the encryption</s> too much effort</p>
<ol>
<li>Hook into the pre-encryption / post-decryption stages</li>
</ol>
<pre><code>/* Send test to 10.251.252.253:28422 */
void hook(void* data, uint data_len) {
  int sock = create_udp4_connection(IPV4_ADDR(10,251,252,253), 28422);
  send(sock, data, data_len, 0);
}
</code></pre>
<ol start=2>
<li>Just look at the app logs<i>*</i></li>
</ol>
<p><small><i>*: Application logs are less verbose in newer FW versions<br>
However they communicate the same way as the older FW versions</i></small></p>
</section><section>
<h2 id=example-mqtt-conversation-span-stylefont-size-24pxm2mstuyaeucomspan>Example MQTT conversation <span style=font-size:24px>(<code>{m2,ms}.tuyaeu.com</code>)</span></h2>
<p>Server Request</p>
<pre><code class=language-json>{
  &quot;id&quot;: 889,
  &quot;method&quot;: &quot;get_prop&quot;,
  &quot;params&quot;: [ &quot;get_status&quot; ]
}
</code></pre>
<p>Device Response</p>
<pre><code class=language-json>{
  &quot;id&quot;: 889,
  &quot;result&quot;: [{
    &quot;msg_ver&quot;: 2,
    &quot;msg_seq&quot;: 275,
    &quot;state&quot;: 8,
    &quot;battery&quot;: 100,
    &quot;clean_time&quot;: 0,
    &quot;clean_area&quot;: 0,
    &quot;error_code&quot;: 3,
    &quot;map_present&quot;: 1,
    &quot;in_cleaning&quot;: 0,
    &quot;in_returning&quot;: 0,
    &quot;in_fresh_state&quot;: 1,
    &quot;lab_status&quot;: 0,
    &quot;water_box_status&quot;: 0,
    &quot;fan_power&quot;: 102,
    &quot;dnd_enabled&quot;: 0,
    &quot;map_status&quot;: 1,
    &quot;lock_status&quot;: 0,
    &quot;events&quot;: []
  }]
}
</code></pre>
</section><section>
<h2 id=example-control-conversation-span-stylefont-size-24pxa2tuyaeucomspan>Example Control conversation <span style=font-size:24px>(<code>a2.tuyaeu.com</code>)</span></h2>
<p>Device Request</p>
<pre><code>HTTP POST
https://a2.tuyaeu.com/d.json?a=tuya.device.timer.count&amp;devId=...&amp;et=1&amp;t=...&amp;v=4.0&amp;sign=...

{&quot;devId&quot;:&quot;...&quot;,&quot;lastFetchTime&quot;:&quot;0&quot;,&quot;t&quot;:1657046157}
</code></pre>
<p>Server Response</p>
<pre><code class=language-json>{
  &quot;result&quot;: {
    &quot;devId&quot;: &quot;...&quot;,
    &quot;count&quot;: 0,
    &quot;lastFetchTime&quot;: 0
  },
  &quot;t&quot;: 1657046159,
  &quot;success&quot;: true
}		
</code></pre>
</section><section>
<h2 id=log-data-span-stylefont-size-24pxxiaomi-fdsspan>Log data <span style=font-size:24px>(Xiaomi FDS)</span></h2>
<div style=display:flex;flex-direction:row>
<div style=min-width:50%>
Data is compressed and encrypted
<ul>
<li><code>/mnt/data/rrlog/**</code></li>
<li><code>/dev/shm/**</code></li>
<li><code>/mnt/reserve/...</code></li>
</ul>
<blockquote>
</blockquote>
<ul>
<li>App logs</li>
<li>Updater logs</li>
<li>&lsquo;Anonymous&rsquo; statistics</li>
<li><code>wlanmgr tcpdump</code></li>
</ul>
</div>
<div>
<img style=flex:1 round src=../../uploads/20220705-snipaste_2022-07-05_20-36-52.jpg>
</div>
</div>
</section><section>
<h2 id=network-map>Network Map</h2>
<p><img src=../../uploads/network.dark_20220725.png width=850px></p>
</section>
</section><section>
<p><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br></p>
<h1 id=demos-and-pocs>Demos and POCs</h1>
<aside class=notes><p>Before we look at threats, let&rsquo;s look at some fun stuff!</p>
</aside>
</section><section>
<h1 id=remote-access-across-the-internet>Remote Access (across the internet!!!)</h1>
<ul>
<li>Easy to perform - system has required libraries and network stack</li>
<li>e.g. Reverse SSH</li>
<li>e.g. VPN / SD-WAN</li>
</ul>
<div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden>
<iframe src=https://www.youtube.com/embed/om2yzYHU1A0 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe>
</div>
</section><section>
<h1 id=reset-persistence-factory-reset-friendly>Reset Persistence (factory reset friendly!!!)</h1>
<blockquote>
<p>#ModifyingTheRecoveryPartitionForFunAndProfit</p>
</blockquote>
<div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden>
<iframe src=https://www.youtube.com/embed/eABmzUfZ22A style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe>
</div>
</section><section>
<h1 id=upgrade-persistence-span-stylefont-size-24pxsee-concept-postpostsachieving-upgrade-persistencespan>Upgrade Persistence <span style=font-size:24px>(<a href=../posts/achieving-upgrade-persistence/>see concept post</a>)</span></h1>
<p><img src=../../uploads/20220711-snipaste_2022-07-12_04-24-24.jpg alt></p>
<section data-shortcode-section>
<h2 id=upgrade-procedure>Upgrade procedure</h2>
<ul>
<li>Download the update to <span style=font-size:.9em;color:grey><code>mmcblk0p1</code></span> (data)</li>
<li>Extract update to <span style=font-size:.9em;color:grey><code>mmcblk0p10</code></span> (updbuf)</li>
<li>Unmount <span style=font-size:.9em;color:grey><code>mmcblk0p8</code></span> (bootA) / <span style=font-size:.9em;color:grey><code>mmcblk0p9</code></span> (bootB)</li>
<li>Flash <span style=font-size:.9em;color:grey><code>updbuf</code></span> to <span style=font-size:.9em;color:grey><code>bootA</code></span> / <span style=font-size:.9em;color:grey><code>bootB</code></span></li>
<li>Boot into <span style=font-size:.9em;color:grey><code>bootA</code></span> / <span style=font-size:.9em;color:grey><code>bootB</code></span></li>
<li>Flash <span style=font-size:.9em;color:grey><code>updbuf</code></span> to <span style=font-size:.9em;color:grey><code>bootB</code></span> / <span style=font-size:.9em;color:grey><code>bootA</code></span></li>
<li>Boot into <span style=font-size:.9em;color:grey><code>bootB</code></span> / <span style=font-size:.9em;color:grey><code>bootA</code></span></li>
</ul>
<blockquote>
</blockquote>
<p>Both filesystems are overwritten (existing changes will disappear)</p>
</section><section>
<h2 id=achieving-upgrade-persistence>Achieving upgrade persistence</h2>
<ul>
<li>Download the update to <span style=font-size:.9em;color:grey><code>mmcblk0p1</code></span> (data)</li>
<li>Extract update to <span style=font-size:.9em;color:grey><code>mmcblk0p10</code></span> (updbuf)</li>
<li>üìù <span style=color:#b94357>Modify contents of <span style=font-size:.9em;color:grey><code>updbuf</code></span></span></li>
<li>Unmount <span style=font-size:.9em;color:grey><code>mmcblk0p8</code></span> (bootA) / <span style=font-size:.9em;color:grey><code>mmcblk0p9</code></span> (bootB)</li>
<li>Flash <span style=color:#b94357>modified</span> <span style=font-size:.9em;color:grey><code>updbuf</code></span> to <span style=font-size:.9em;color:grey><code>bootA</code></span> / <span style=font-size:.9em;color:grey><code>bootB</code></span></li>
<li>Boot into <span style=font-size:.9em;color:grey><code>bootA</code></span> / <span style=font-size:.9em;color:grey><code>bootB</code></span></li>
<li>Flash <span style=color:#b94357>modified</span> <span style=font-size:.9em;color:grey><code>updbuf</code></span> to <span style=font-size:.9em;color:grey><code>bootB</code></span> / <span style=font-size:.9em;color:grey><code>bootA</code></span></li>
<li>Boot into <span style=font-size:.9em;color:grey><code>bootB</code></span> / <span style=font-size:.9em;color:grey><code>bootA</code></span></li>
</ul>
<blockquote>
</blockquote>
<p>Modify the extracted updated firmware, so changes propagate</p>
</section><section>
<h2 id=how-to-modify>How to modify?</h2>
<ul>
<li>Alter the <label><code>SysUpdate</code></label> binary to include modification steps</li>
<li>Service / cron / repeated task to write into <code>/mnt/updbuf</code></li>
</ul>
<aside class=notes><p>Altering the <code>SysUpdate</code> binary is probably more reliable.<br>
If using a repeated or scheduled task - we&rsquo;d have to have a fast loop to intercept the extraction - but a lesser loop period means more wasted executions</p>
</aside>
</section><section>
<h2 id=what-to-modify>What to modify?</h2>
<ul>
<li>Remote access
<ul>
<li><code>/etc/passwd</code></li>
<li><code>/usr/bin/adbd</code></li>
<li><code>/usr/sbin/dropbear</code></li>
<li>VPN / SD-WAN</li>
<li>iptables <span style=font-size:.6em>(various locations)</span></li>
</ul>
</li>
<li>üîä Sounds?</li>
<li>Future upgrade persistence
<ul>
<li><code>SysUpdate</code></li>
<li>Scheduled / repeated jobs</li>
</ul>
</li>
</ul>
</section>
</section><section>
<h1 id=ota-rooting>OTA Rooting</h1>
<section data-shortcode-section>
<pre><code class=language-json>{
  &quot;method&quot;: &quot;miIO.ota&quot;,
  &quot;params&quot;: {
    &quot;mode&quot;: &quot;normal&quot;,
    &quot;install&quot;: &quot;1&quot;,
    &quot;app_url&quot;: &quot;http://192.168.8.110:8322/firmware&quot;, // this looks definitely controllable!
    &quot;file_md5&quot;: &quot;6e24b0454b170f67676693b759fba742&quot;,
    &quot;proc&quot;: &quot;dnld install&quot;
  },
  &quot;id&quot;: 474627483
}
</code></pre>
<p>During device initialisation, an OTA update payload could be sent&mldr;<br>
<a href=https://featherbear.cc/UNSW-CSE-Thesis/posts/ota-updates-blocked-as-of-late-2019/>Remote root / backdoor</a>!!</p>
<blockquote>
<p>However&mldr; patched a long time ago</p>
</blockquote>
</section><section>
<ul>
<li>OTA updates during device initialisation were disabled in a November 2019 firmware update.
<ul>
<li>Remember - Product was released June 2019 </li>
</ul>
</li>
<li>This method of attack is limited to devices that are
<ul>
<li>Not yet initialised (else will have to be factory reset)</li>
<li>Manufactured within 4 months of the device being first sold</li>
</ul>
</li>
</ul>
<p><img src=../../uploads/20220719-snipaste_2022-07-20_03-11-19.png alt></p>
</section>
</section><section>
<h1 id=lets-talk-threats>Let&rsquo;s Talk Threats</h1>
<ul>
<li><label>TS0 - No malicious threat</label>
<ul>
<li>Visibility and ownership of the data / device</li>
</ul>
</li>
<li><label>TS1 - Physical (proximal) threat</label>
<ul>
<li>Supply-chain</li>
<li>Second-hand seller</li>
<li>Someone with momentary/prolonged access</li>
</ul>
</li>
<li><label>TS2 - Remote (proximal) threat</label>
<ul>
<li>Nearby, on the network</li>
<li>Nearby, outside of the network</li>
</ul>
</li>
<li><label>TS3 - Remote (distal) threat</label>
<ul>
<li>Backdoor</li>
<li>Vendor, C2</li>
</ul>
</li>
</ul>
<p><span style=color:grey>exc: Usage of the data in the cloud</span></p>
</section><section>
<h1 id=ts0---no-malicious-threat>TS0 - No malicious threat</h1>
<section data-shortcode-section>
<blockquote>
<p>Data Visibility and Ownership</p>
</blockquote>
<div style=display:flex;flex-direction:row>
<div style=text-align:center;flex:1>
<img round src=../../uploads/Screenshot_20220726-081528_Roborock.jpg width=70%>
</div>
<div>
<ul>
<li>How do I know what data is being collected?
<ul>
<li>Privacy policy<a href=#/9/1>‚Ñ¢</a></li>
</ul>
</li>
<li>How do I know what data is <label>actually</label> being collected?
<ul>
<li>Need equipment, skills, willingness</li>
<li>Patience to unscrew a lot of screws</li>
<li>Encryption</li>
</ul>
</li>
<li>(How) Can I control the data that is collected?
<ul>
<li>Locally? Remotely?</li>
</ul>
</li>
<li>(How) Can I confirm <em>my</em> data has been deleted?</li>
</ul>
<p><small>Data includes: map data, <s>[camera]</s>, <s>[microphone]</s>, app logs, <br>process list, network config, network data, statistics</small></p>
</div>
</div>
</section><section>
<blockquote>
<p>Device Visibility and Ownership</p>
</blockquote>
<div style=display:flex;flex-direction:row>
<div>
<ul>
<li>Is this device really mine?</li>
<li>Can I see what <em>my</em> device is doing?</li>
<li>Can I modify <em>my own</em> device</li>
</ul>
<p>‚ùå Communications are encrypted<br>
‚ùå Logs are encrypted<br>
‚ùå Restricted <code>adbd</code>, <code>ssh</code>, <code>serial</code></p>
<ul>
<li>But otherwise yes
<ul>
<li>It&rsquo;s just Linux</li>
<li>No hardware restrictions to flashing</li>
</ul>
</li>
</ul>
</div>
<div style=text-align:center;flex:1>
<div><img round src=../../uploads/Snipaste_2022-07-28_05-48-58.jpg width=75%></div>
<small>Would you pay for hardware<br>.. then pay more to use it?</small>
</div>
</div>
</section>
</section><section>
<h1 id=ts1---physical-proximal-threat>TS1 - Physical (proximal) threat</h1>
<blockquote>
<p><span style=font-size:.5em>The &ldquo;friend-who-has-your-WiFi-password-even-though-you-didn&rsquo;t-give-it-to-them&rdquo;</span></p>
</blockquote>
<div style=display:flex;flex-direction:row>
<div>
<label>Prolonged access</label>
<p>‚úîÔ∏è Efforts to restrict serial access<br>
‚ö†Ô∏è Supply chain</p>
<ul>
<li>Extract user/device/app data</li>
<li>Modifications
<ul>
<li>Persistence</li>
<li>Remote access</li>
<li>Jumphost</li>
<li>Eavesdropping</li>
</ul>
</li>
</ul>
</div>
<div>
<label>Momentary access</label>
<p>‚úîÔ∏è <code>adbd</code> (USB access) is restricted<br>
‚úîÔ∏è No fast hands-off attack vector</p>
<ul>
<li>
<p>Need to open up the device</p>
</li>
<li>
<p>Takes time to gain shell access</p>
</li>
<li>
<p>Reset + OTA root</p>
<ul>
<li><span style=font-size:.9em>&ldquo;I wonder what this <em>reset button</em> does&rdquo;</span></li>
<li><span style=color:grey>Pre-Nov 2019 units only</span></li>
</ul>
</li>
</ul>
</div>
</div>
</section><section>
<h1 id=ts2---remote-proximal-threat>TS2 - Remote (proximal) threat</h1>
<blockquote>
<p>The &ldquo;coffee shop hacker&rdquo;</p>
</blockquote>
<p>‚úîÔ∏è All data is encrypted (application level, not just TLS)!<br>
‚úîÔ∏è IPv6 blocked<br>
‚úîÔ∏è SSH server port blocked by default<br>
‚ö†Ô∏è &mldr;other services?<br>
‚ö†Ô∏è OTA rooting <span style=color:grey>(patched Nov 2019)</span><br>
‚ùå Wireless credentials can be sniffed during pairing (+ promiscuous)</p>
<div style=text-align:center>
<img round src=../../uploads/Snipaste_2022-05-02_01-14-22.jpg width=40%>
</div>
</section><section>
<h1 id=ts3---remote-distal-threat>TS3 - Remote (distal) threat</h1>
<p><label>Vendor</label></p>
<p>‚ö†Ô∏è Access to user/device/app data<br>
‚ö†Ô∏è Ability to issue remote commands<br>
‚ö†Ô∏è Network packet logging<br>
‚ö†Ô∏è Potential arbitrary execution in future releases<br>
<a href=#/9/1>‚ö†Ô∏è</a> Privacy policy discrepancy</p>
<p><br></p>
<p><label>Other</label></p>
<p>‚ö†Ô∏è Is my device backdoored?<br>
‚ö†Ô∏è Unknown nature of expected traffic (see later)<br>
‚ö†Ô∏è Vuln > RCE = root control</p>
</section><section>
<h1 id=privacy--security-response>Privacy / Security Response</h1>
<section data-shortcode-section>
<p><label>Roborock</label></p>
<p>‚úîÔ∏è Evidence of buffer overflow checks in the binary<br>
‚úîÔ∏è Application-level encryption<br>
‚úîÔ∏è Reduction in log verbosity (though not consistent)<br>
‚úîÔ∏è <code>ip{,6}tables</code> rules<br>
‚úîÔ∏è Tightening of access through <code>adb</code>, <code>ssh</code>, <code>serial</code><br>
‚úîÔ∏è They seem to respond to security incidents<br>
‚úîÔ∏è (some) effort to uphold privacy and define data usage</p>
</section><section>
<p>‚ö†Ô∏è They seem to respond to security incidents. <label><i style=font-style:italic>sort of</i></label></p>
<blockquote>
</blockquote>
<h2 id=disclosures>Disclosures</h2>
<ul>
<li>Only <label>one</label> vulnerability disclosure listed on their <a href=https://global.roborock.com/pages/disclosure-security-vulnerability-on-tuya-iot-cloud>webpage</a>
<ul>
<li><em>8 years of business, 15 products, 1 vulnerability?</em></li>
<li>No CVE / other detail report</li>
</ul>
</li>
<li>Perhaps more, but undisclosed</li>
</ul>
<div style=text-align:center>
<img round src=../../uploads/Snipaste_2022-07-28_08-49-02.jpg width=50%>
</div>
</section><section>
<h2 id=what-about-other-companies>What about other companies?</h2>
<p><span style=display:inline-table;vertical-align:middle><img src=../../uploads/tuya_logo.png height=40px alt=Tuya></span> <span style=color:grey;font-size:.6em>(IoT Ecosystem, Whitelabel Vendor)</span> and <span style=display:inline-table;vertical-align:middle><img src=../../uploads/xiaomi_smartlife_logo.webp height=40px alt="Mijia (Xiaomi)"></span> Xiaomi <span style=color:grey;font-size:.6em>(IoT Ecosystem)</span> have published CVEs</p>
<ul>
<li>Reminder; not a necessity</li>
<li>They both have large security teams and bug bounty programs
<ul>
<li>Bigger company</li>
<li>More at stake</li>
</ul>
</li>
</ul>
<p><br></p>
<div style=text-align:center>
<img round src=../../uploads/Snipaste_2022-07-28_09-01-52.jpg width=70%>
</div>
</section><section>
<div style=display:flex;flex-direction:row>
<div>
<div style=text-align:center><a href=https://featherbear.cc/UNSW-CSE-Thesis/posts/tuya-white-paper/><img round src=../../uploads/Snipaste_2022-07-28_09-06-38.jpg width=50%></a></div>
</div>
<div>
<div style=text-align:center><a href=https://featherbear.cc/UNSW-CSE-Thesis/posts/xiaomi-cyber-security-baseline-for-consumer-internet-of-things/><img round src=../../uploads/Snipaste_2022-07-28_09-07-28.jpg width=50%></a></div>
</div>
</div>
<p>Both companies have white-papers / publications about security minimums.</p>
<p><small><b>Note</b><br>The Tuya paper mentions encryption during the pairing process.<br>The Roborock S6 (which integrates the Tuya platform), <label>fails to do so</label>.<br><br>Is there a compliance check / verification between either party?</small></p>
</section>
</section><section>
<h1 id=towards-an-expected-conversation---rfc-8520>Towards an expected conversation - RFC 8520</h1>
<blockquote>
<p><a href=https://datatracker.ietf.org/doc/rfc8520/>RFC 8520</a> - Manufacturer Usage Description</p>
</blockquote>
<section data-shortcode-section>
<p><img round src=../../uploads/20220725-snipaste_2022-07-26_07-37-41.jpg></p>
<p><a href=https://developer.cisco.com/docs/mud/#!what-is-mud/what-is-mud>MUD</a> files whitelist the nature of network traffic that a device should transmit/receive. <span style=font-size:.8em;color:grey>(e.g. Transmit IPv4 tcp/8890 to (DNS) example.com)</span></p>
<p>Traffic that does not match the MUD are discarded (or allowed but flagged). Mitigates unexpected ports/hosts - but ineffective against <span style=font-size:.6em>(e.g.)</span> C2 payloads</p>
<p>IoT Research Team @ <a href=https://iotanalytics.unsw.edu.au/mudprofiles>UNSW EE&T</a> has done some research</p>
</section><section>
<div style=display:flex;flex-direction:row>
<div>
<img round src=../../uploads/20220725-snipaste_2022-07-26_07-26-49.jpg>
</div>
<div>
RFC8520 was approved and published in <label>March 2019</label>
<br>
<br>
<p>But is anyone adopting it?</p>
</div>
</section>
</section><section>
<blockquote>
</blockquote>
<div>
How have manufacturers of IoT / smart home devices addressed the increasing concerns of digital privacy and product security?
<div style=text-align:right;font-size:20px>(Specifically Roborock)</span>
</div>
<blockquote>
</blockquote>
<p>‚úîÔ∏è Data is cleared during resets<br>
‚úîÔ∏è Lockdown on access methods (ADB, Serial, MiIO, SSH, IPv6)<br>
‚úîÔ∏è Data is encrypted during transit</p>
<p><label>but more can be done</label></p>
<p>üî• Further transparency in disclosures<br>
üî• Improved privacy policy<br>
üî• Pairing encryption<br>
üî• Data should be cleared on device disassociation<br>
üî• Better co-ordination between ecosystems and vendors<br>
üî• MUD files - both devices and infrastructure<br>
üî• Whitepapers, bug bounties</p>
</section><section>
<h1 id=future-work>Future Work</h1>
<ul>
<li>Test the mobile app</li>
<li>Test the cloud infrastructure</li>
<li>Test MITM - HSTS?</li>
<li>Make MUD profile</li>
<li>Fuzz exposed ports
<ul>
<li>e.g. <code>rr_loader</code> service</li>
</ul>
</li>
</ul>
</section><section>
<h1 id=aside-thesis-in-a-year>Aside: Thesis in a Year</h1>
<p><a href=https://featherbear.cc/UNSW-CSE-Thesis/tldr/><img src=../../uploads/screely-1658645824986.png alt></a></p>
</section><section>
<h1 id=thank-you>Thank You</h1>
<p><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br></p>
<hr>
<p>Andrew Wong</p>
<sub>
<p>w: <a href=https://featherbear.cc/UNSW-CSE-Thesis>featherbear.cc/UNSW-CSE-Thesis</a></p>
<p>e: <script>document.write(atob('YW5kcmV3Lmoud29uZ0BzdHVkZW50LnVuc3cuZWR1LmF1'))</script></p>
</sub>
<blockquote>
</blockquote>
</section>
</div>
</div>
<script type=text/javascript src=../../reveal-hugo/object-assign.js></script>
<a href=../../reveal-js/css/print/ id=print-location style=display:none></a>
<script type=text/javascript>var printLocationElement=document.getElementById('print-location'),link=document.createElement('link');link.rel='stylesheet',link.type='text/css',link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?'pdf.css':'paper.css'),document.getElementsByTagName('head')[0].appendChild(link)</script>
<script type=application/json id=reveal-hugo-site-params>{"center":false,"custom_theme":"presentations/theme.scss","custom_theme_compile":true,"dependencies":[{"src":"../plugins/capsLockKeymod.js"}],"history":true,"pdf_separate_fragments":true,"slide_number":true,"width":1024}</script>
<script type=application/json id=reveal-hugo-page-params>null</script>
<script src=../../reveal-js/js/reveal.js></script>
<script type=text/javascript>var revealHugoDefaults,revealHugoSiteParams,revealHugoPageParams,options;function camelize(a){return a&&Object.keys(a).forEach(function(b){newK=b.replace(/(\_\w)/g,function(a){return a[1].toUpperCase()}),newK!=b&&(a[newK]=a[b],delete a[b])}),a}revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML),revealHugoPageParams=JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams)),Reveal.initialize(options)</script>
<script type=text/javascript src=../../reveal-js/plugin/markdown/marked.js></script>
<script type=text/javascript src=../../reveal-js/plugin/markdown/markdown.js></script>
<script type=text/javascript src=../../reveal-js/plugin/highlight/highlight.js></script>
<script type=text/javascript src=../../reveal-js/plugin/zoom-js/zoom.js></script>
<script type=text/javascript src=../../reveal-js/plugin/notes/notes.js></script>
<script type=text/javascript>for(let a of document.querySelectorAll(".reveal .slides > section"))a.dataset.transition||(a.dataset.transition="fade-out slide-in");document.querySelectorAll('p img').forEach(b=>{if(b.alt!='center')return;let a=b;while(a.tagName!='P')a=a.parentNode;a.style.textAlign='center'})</script>
</body>
</html>