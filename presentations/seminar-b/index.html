<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<title>Seminar B | Andrew Wong</title>
<meta name=description content="Musings of a CSE Thesis">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="black-translucent">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<link rel=stylesheet href=../../reveal-js/css/reset.css>
<link rel=stylesheet href=../../reveal-js/css/reveal.css>
<link rel=stylesheet href=../../_.min.a230c4a7a1567dd6102968d8163a8141477da8488849428e390a8cd00a44c5a7.css id=theme><link rel=stylesheet href=../../highlight-js/default.min.css>
</head>
<body>
<div class=reveal>
<div class=slides>
<section data-noprocess data-shortcode-slide data-background-image=/uploads/covers/0T4A9791.JPG data-transition=fade>
<p><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br></p>
<h3 id=smart-vacuum-cleaners>&ldquo;Smart&rdquo; Vacuum Cleaners</h3>
<h5 id=an-audit-into-the-security-and-integrity-of-iot-systems>An Audit Into The Security and Integrity of IoT Systems</h5>
<h6 id=andrew-wong--unsw-sydney>Andrew Wong | UNSW Sydney</h6>
</section><section>
<h1 id=todays-agenda>Today&rsquo;s Agenda</h1>
</section><section>
<h1 id=statement>Statement</h1>
<blockquote>
</blockquote>
<p>How have manufacturers of IoT / smart home devices addressed the increasing concerns of digital privacy and product security?</p>
<blockquote>
</blockquote>
<span class=fragment><p> <br>
 </p>
<ul>
<li>Digital Privacy - Investigate the nature of network data (i.e. content, frequency, destination) and how the data is used.</li>
<li>Product Security - Investigate potential security vulnerabilities and assess the effectiveness of current security fortifications.</li>
</ul>
</span>
</section>
<section data-noprocess data-shortcode-slide data-background-image=/uploads/20211030_040050.jpg data-transition=fade>
<p><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br></p>
<h3 id=work-performed>Work Performed</h3>
</section><section>
<h1 id=fingerprinting>Fingerprinting</h1>
<section data-shortcode-section>
<p><label>System</label></p>
<pre><code>[ 0.340]U-Boot 2011.09-rc1-dirty (Mar 25 2020 - 20:45:43) Allwinner Technology
[ 0.000000] Linux version 3.4.39 (rockrobo@apimg) (gcc version 4.8.4 (Ubuntu/Linaro 4.8.4-2ubuntu1~14.04.1) ) #1 SMP PREEMPT Wed Mar 25 20:47:59 CST 2020
[ 0.000000] CPU: ARMv7 Processor [410fc075] revision 5 (ARMv7), cr=10c5387d
[ 0.000000] Machine: sun8i
...
</code></pre>
<p>CPU: Allwinner R16 (ARM Cortex-A7) - ARMv7l / armhf<br>
ACU: STM32F103VCT6 (ARM Cortex-M3)<br>
Roborock Firmware version: 3.5.4_1558<br>
Operating system: Ubuntu 14.04.3 LTS</p>
</section><section>
<p><label>Users</label></p>
<div style=display:flex;flex-direction:row>
<div><img round src=../../uploads/Snipaste_2022-05-01_20-00-22.jpg></div>
<div><img round src=../../uploads/Snipaste_2022-05-01_20-00-48.jpg></div>
</div>
<blockquote>
<p>No additional users</p>
</blockquote>
<blockquote>
</blockquote>
<pre><code>root@rockrobo:~# ls /home
ruby
</code></pre>
<p><code>/home/ruby</code> exists but no user <code>ruby</code>, though exists in <code>/etc/passwd~</code></p>
</section><section>
<p><label>Processes</label></p>
<p>🚩 Everything is running as root</p>
<div style=text-align:center>
<img src=../../uploads/Snipaste_2022-05-01_19-33-46.jpg width=80%>
</div>
</section><section>
<p><label>Ports</label></p>
<pre><code class=language-bash>root@rockrobo:~# netstat -nltp
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 127.0.0.1:54322         0.0.0.0:*               LISTEN      991/miio_client 
tcp        0      0 127.0.0.1:54323         0.0.0.0:*               LISTEN      991/miio_client 
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1644/sshd       
tcp        0      0 127.0.0.1:55551         0.0.0.0:*               LISTEN      998/rriot_tuya  
tcp        0      0 0.0.0.0:6668            0.0.0.0:*               LISTEN      998/rriot_tuya  
tcp6       0      0 :::22                   :::*                    LISTEN      1644/sshd       
</code></pre>
<p><code>tcp/22</code> and <code>tcp/6668</code> are exposed</p>
</section><section>
<p><label>Firewall</label></p>
<p>iptables?</p>
</section><section>
</section>
</section><section>
<h1 id=going-wireless---establishing-ssh>Going wireless - establishing SSH</h1>
<div style=display:flex;flex-direction:row;align-items:center>
<img src=iptables.png width=65% style=flex:1>
<div style=flex:1>
<ul>
<li>Why is there an SSH server running?</li>
<li>What&rsquo;s runs on port 6665
<ul>
<li><code>player</code></li>
<li>Why not file-based IPC?</li>
</ul>
</li>
<li>Can I ping the internet
<ul>
<li>Yep!</li>
</ul>
</li>
<li>Can I add persistent access?
<ul>
<li>Yes, modify <code>rrwatchdoge.conf</code></li>
<li>Can also add remote access
<ul>
<li>e.g. ZeroTier</li>
</ul>
</li>
</ul>
</li>
<li>IPv6</li>
</ul>
</div>
</div>
</section><section>
<section data-shortcode-section>
<h1 id=trivial-power-analysis>Trivial Power Analysis</h1>
<blockquote>
<p>Batteries dont&rsquo;t last forever!</p>
</blockquote>
<p><img src=../../uploads/20220501_051651.jpg alt></p>
</section><section>
<blockquote>
<p>What if I unplug the battery?</p>
</blockquote>
<ul>
<li>No change in output during boot</li>
<li>But device will turn off after around 20 seconds</li>
</ul>
<p>See <a href=https://featherbear.cc/UNSW-CSE-Thesis/posts/power/serial-dump-during-2-wire-power/>2-wire log</a>, <a href=https://featherbear.cc/UNSW-CSE-Thesis/posts/power/serial-dump-during-4-wire-power/>4-wire log</a></p>
</section>
</section><section>
<section data-shortcode-section>
<h1 id=file-system-imaging>File System Imaging</h1>
<p>The eMMC only has 4GB of storage, so we can&rsquo;t (also shouldn&rsquo;t) image the flash onto itself&mldr; but we can image it remotely!</p>
<pre><code class=language-bash>IP=10.10.10.8
for partition in `ssh root@$IP &quot;ls /dev/mmcblk0?* -1&quot;`
do
    ssh root@$IP &quot;sudo dd if=$partition bs=1M&quot; | dd of=$(basename $partition).img
done
</code></pre>
<div style=text-align:center>
<img src=../../uploads/20220430-disk_imaging.jpg>
</div>
</section><section>
<h1 id=file-system-structure>File System Structure</h1>
<table>
<thead>
<tr>
<th style=text-align:left>partition</th>
<th style=text-align:left>label</th>
<th style=text-align:left>size</th>
<th style=text-align:left>description</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left>mmcblk0p1</td>
<td style=text-align:left>UDISK</td>
<td style=text-align:left>1.5 GB</td>
<td style=text-align:left>user data</td>
</tr>
<tr>
<td style=text-align:left>mmcblk0p2</td>
<td style=text-align:left>boot-res</td>
<td style=text-align:left>8 MB</td>
<td style=text-align:left>bootloader stuff</td>
</tr>
<tr>
<td style=text-align:left>mmcblk0p5</td>
<td style=text-align:left>env</td>
<td style=text-align:left>16 MB</td>
<td style=text-align:left></td>
</tr>
<tr>
<td style=text-align:left>mmcblk0p6</td>
<td style=text-align:left>app (RO)</td>
<td style=text-align:left>64 MB</td>
<td style=text-align:left>device data</td>
</tr>
<tr>
<td style=text-align:left>mmcblk0p7</td>
<td style=text-align:left>recovery</td>
<td style=text-align:left>512 MB</td>
<td style=text-align:left>stock firmware</td>
</tr>
<tr>
<td style=text-align:left>mmcblk0p8</td>
<td style=text-align:left>system_a</td>
<td style=text-align:left>512 MB</td>
<td style=text-align:left>Main OS (boot)</td>
</tr>
<tr>
<td style=text-align:left>mmcblk0p9</td>
<td style=text-align:left>system_b</td>
<td style=text-align:left>512 MB</td>
<td style=text-align:left>Backup OS</td>
</tr>
<tr>
<td style=text-align:left>mmcblk0p10</td>
<td style=text-align:left>Download</td>
<td style=text-align:left>528 MB</td>
<td style=text-align:left>Update temp</td>
</tr>
<tr>
<td style=text-align:left>mmcblk0p11</td>
<td style=text-align:left>reserve</td>
<td style=text-align:left>16 MB</td>
<td style=text-align:left>blackbox???</td>
</tr>
</tbody>
</table>
</section><section>
<h1 id=recovery-reset>Recovery Reset</h1>
<p>Recovery supposedly resets <code>system_a</code>, <code>system_b</code>, <code>UDISK</code> and <code>Download</code></p>
<div style=text-align:center>
<img src=../../uploads/20220501-recovery.png width=70%>
</div>
<p>What about the other partitions? If we want to plant malicious software, can put it in <code>recovery</code> and <code>system_a</code>?</p>
</section><section>
<div style=display:flex;flex-direction:row;align-items:center>
<img src=../../uploads/Snipaste_2022-05-01_05-53-51.jpg width=65% style=flex:1>
<div style=flex:1>
<blockquote>
<p>28,189 files&mldr;</p>
</blockquote>
<blockquote>
<p>Well there&rsquo;s for sure a lot of files to look at&mldr;</p>
</blockquote>
</div>
</div>
<p>TODO: Recovery partition is modifiable</p>
</section><section>
<h1 id=i-did-a-thing---commentreehttpsgithubcomfeatherbearcommentree>I did a thing - <a href=https://github.com/featherbear/commentree>Commentree</a></h1>
<blockquote>
<p>Plain-text annotation / commentary tool</p>
</blockquote>
<p><img src=commentree.png alt> </p>
</section>
</section><section>
<h2 id=interesting-files>Interesting Files</h2>
<p>mmcblk0p1/miio/device.token=utnevRELra5sqef3
mmcblk0p1/miio/device.uid=1738271950
mmcblk0p1/rockrobo/
mmcblk0p11\endpoint.bin - AWS address + key?
mmcblk0p7\boot\zImage - bootloader
vinda usage</p>
<p>passwords
syslogs</p>
<pre><code>Look for IPs, emails, host/domains, passwords, keys
Check where DID and UID is used
Dummy data to check if it’s logged
</code></pre>
<p>What other files were changed?</p>
<p>compare against base ubuntu system?</p>
<p>miio
mmcblk0p7\opt\rockrobo
rrlog
rriot</p>
<p>ADB</p>
<h3 id=adb>adb</h3>
<p>adb custom</p>
<p><a href=https://featherbear.cc/UNSW-CSE-Thesis/posts/mmcblk0p7-usr-bin-adbd/>https://featherbear.cc/UNSW-CSE-Thesis/posts/mmcblk0p7-usr-bin-adbd/</a></p>
<pre><code>mmcblk0p6\adb.conf

mmcblk0p8\var\log\upstart\adbd.log
</code></pre>
</section><section>
<p>/usr/sbin/tcpdump</p>
<p><img src=../../uploads/Snipaste_2022-05-01_19-44-27.jpg alt></p>
<p><img src=../../uploads/Snipaste_2022-05-01_19-37-08.jpg alt></p>
</section><section>
<p>mmcblk0p7\usr\sbin\tcpdump</p>
<p>/var/log/apt/history.log</p>
<pre><code>Start-Date: 2016-01-25  11:18:05
Commandline: /usr/bin/apt-get install rsync
Install: rsync:armhf (3.1.0-2ubuntu0.2)
End-Date: 2016-01-25  11:18:11

Start-Date: 2016-04-05  12:30:59
Commandline: /usr/bin/apt-get install ccrypt
Install: ccrypt:armhf (1.10-4)
End-Date: 2016-04-05  12:31:01

Start-Date: 2016-04-25  09:58:29
Commandline: /usr/bin/apt-get install tcpdump
Install: tcpdump:armhf (4.5.1-2ubuntu1.2), libpcap0.8:armhf (1.5.3-2, automatic)
End-Date: 2016-04-25  09:58:33
</code></pre>
</section><section>
<p>Static binaries</p>
<p><code>./htop --sort-key=PID -C</code></p>
</section><section>
<p>Compare against standards (i.e. Xiaomi&rsquo;s standard)</p>
</section><section>
<h1 id=thesis-consideration---some-thoughts-and-discussions>Thesis consideration - some thoughts and discussions</h1>
<p><small>How have manufacturers of IoT / smart home devices addressed the increasing concerns of digital privacy and product security?</small></p>
<aside class=notes>We&rsquo;re not answering the question just yet, just some thoughts</aside>
<ul>
<li>
<p>Wireless credentials are stored in plain text</p>
<ul>
<li>wpa_supplicant is part of the underlying Linux framework</li>
</ul>
</li>
<li>
<p>SSH server running (though iptables)</p>
</li>
<li>
<p><code>player</code> exposes port 6665</p>
</li>
<li>
<p>Processes are running as root</p>
<ul>
<li>Any vulnerability in any of the programs can result in system takeover, dropping of iptables, persistence planting</li>
</ul>
</li>
<li>
<p>Recovery partition is modifiable</p>
<ul>
<li><code>mount /dev/mmcblk0p7 ...</code></li>
</ul>
</li>
<li>
<p>netcat, tcpdump, ccrypt?</p>
</li>
<li>
<p>Easier to interface with devices (udev rules)</p>
</li>
</ul>
<p>How easy is it for someone to attack the system?</p>
<h2 id=heading></h2>
<p>What&rsquo;s Good</p>
<ul>
<li>
<p>iptables</p>
</li>
<li>
<p>some logs are encrypted locally</p>
</li>
<li>
<p>Hands-on access a system = game over</p>
<ul>
<li>But should it be?</li>
</ul>
</li>
</ul>
<p>Are there any backdoors?
outbound requests
persistent software (install to recovery + system_a)</p>
</section><section>
</section><section>
<p><img src=proc_misc.png alt></p>
<ul>
<li>Can I plant software (y)</li>
</ul>
</section><section>
<ul>
<li>Why is netcat installed but not curl, wget?</li>
<li>TODO: Check what gets cleared during a format / update</li>
</ul>
</section><section>
<h1 id=capturing-network-data-during-device-registration>Capturing network data during device registration</h1>
<ul>
<li>Have shell access but</li>
<li>PolarProxy is too new for Ubuntu 14.04</li>
<li>apt update doesn&rsquo;t work with socks5:// or http proxies properly</li>
</ul>
<p>On the smart app side</p>
<p>Frida nope
windows env nope
<a href=https://github.com/NickstaDB/patch-apk>https://github.com/NickstaDB/patch-apk</a>
<a href=https://blog.silentsignal.eu/2020/05/04/decrypting-and-analyzing-https-traffic-without-mitm/>https://blog.silentsignal.eu/2020/05/04/decrypting-and-analyzing-https-traffic-without-mitm/</a>
RoboRock app</p>
<p>during pairing the password is transmitted in plaintext</p>
</section><section>
<p><img src=../../uploads/Snipaste_2022-05-02_01-14-22.jpg alt="plain text wifi auth wireshark">
<img src=../../uploads/Snipaste_2022-05-02_01-42-29.jpg alt="zerotier persistence"></p>
</section><section>
<h1 id=current-challenges---equipment>Current Challenges - Equipment</h1>
<style>img[round]{border-radius:10px}</style>
<ul>
<li>Electricity is dangerous</li>
<li>Using personal equipment is not a good idea for a test-bench</li>
<li>👏 Thank you Gigabyte for having ESD-protected USB ports</li>
</ul>
<p><img round src=../../uploads/20220501_031636.jpg></p>
</section><section>
<h1 id=rrlogd>rrlogd</h1>
<section data-shortcode-section>
<p>Logs are encrypted at rest (after being packed)</p>
<p><img src=Snipaste_2022-05-02_03-10-57.jpg alt></p>
</section><section>
<p>Possible functionality to perform any arbitrary command?</p>
<p><img src=../../uploads/Snipaste_2022-05-02_02-34-04.jpg alt="system() call"></p>
</section><section>
<div style=display:flex;flex-direction:row>
<div><img src=../../uploads/Snipaste_2022-05-02_02-37-10.jpg></div>
<div><img src=../../uploads/Snipaste_2022-05-02_02-46-06.jpg></div>
</div>
<p>Logging program has the potential to unblock port 22?</p>
<pre><code>iptables -I INPUT -j ACCEPT -p tcp --dport 22
</code></pre>
</section>
</section><section>
</section><section>
<h1 id=unfinished-work>Unfinished Work</h1>
<ul>
<li>Still a lot of files to look at</li>
<li>Need to figure out which files are worthwhile to inspect</li>
</ul>
<section data-shortcode-section>
</section><section>
<p><label>Approach 1 - Filter by date modified</label></p>
<blockquote>
<p>Ubuntu 14.04.3 LTS was released back in 2014, any changes would have a later timestamp</p>
</blockquote>
<div style=display:flex;flex-direction:row>
<div><img src=../../uploads/20220501-ubuntu_release_date.png></div>
<div><img src=../../uploads/Snipaste_2022-05-01_06-43-50.jpg alt="sort by date might give some clues"></div>
</div>
</section><section>
<p><label>Approach 2 - File Comparisons</label></p>
<div style=display:flex;flex-direction:row;align-items;center>
<div style=width:65%><img src=../../uploads/20220501-ubuntu_14.04.3.png></div>
<div>
<p>Compare executable files and find<br>
differences in binary function</p>
<p><a href=https://www.zynamics.com/software.html>bindiff</a>, <a href=https://github.com/ReFirmLabs/binwalk>binwalk</a>, <a href=https://github.com/ssdeep-project/ssdeep>ssdeep</a>, <a href=https://github.com/sdhash/sdhash>sdhash</a></p>
<p><small>As seen in <label>A Large-Scale Analysis of the Security of Embedded Firmwares</label> - Andrei C, Jonas Z, Aur&rsquo;elien F, Davide B</small></p>
</div>
</div>
<aside class=notes><p>From literature review</p>
</aside>
</section>
</section><section>
<h1 id=retrospective>Retrospective</h1>
<ul>
<li>Time management / busy / other work</li>
<li>Could have done more work</li>
</ul>
</section><section>
<h1 id=project-timeline>Project Timeline</h1>
<h4 id=labelthesis-alabel><label>Thesis A</label></h4>
<ul>
<li>Initial research and research environment setup</li>
<li>Teardown and initial hands-on of Roborock S6</li>
</ul>
<h4 id=labelthesis-b---binary-assessmentlabel><label>Thesis B - Binary Assessment</label></h4>
<ul>
<li>Disassembly and analysis of firmware binaries to identify vulnerabilities
<ul>
<li>inc. ADB binary functionality</li>
</ul>
</li>
<li>Search for unsecured secrets, logs, configurations</li>
</ul>
<h4 id=labelthesis-c---connectivity-assessmentlabel><label>Thesis C - Connectivity Assessment</label></h4>
<ul>
<li>Inspection of outbound internet traffic - security, PII, etc</li>
<li>Inspection of local network traffic</li>
<li>Inspection of interaction with nearby devices</li>
<li>Protocol analysis</li>
</ul>
</section><section>
<h1 id=static-binary-assessment>[Static] Binary assessment</h1>
<h1 id=in-the-mean-time>In the mean time</h1>
<h1 id=findings>Findings</h1>
</section><section>
<h2 id=project-plan>Project Plan</h2>
<h2 id=revised-project-plan>Revised Project Plan</h2>
</section><section>
<h1 id=next-steps>Next Steps</h1>
<ul>
<li>Dump the firmware and begin RE / forensics</li>
<li>Redo (and further investigate) live system analysis
<ul>
<li>i.e. Properly capture <em>all</em> network traffic</li>
</ul>
</li>
</ul>
</section><section>
<h1 id=any-questions>Any Questions?</h1>
<p><br>
<br>
<br>
<br>
<br>
<br>
<br>
<br></p>
<hr>
<p>Andrew Wong</p>
<sub>
<p>w: <a href=https://featherbear.cc/UNSW-CSE-Thesis>featherbear.cc/UNSW-CSE-Thesis</a></p>
<p>e: <script>document.write(atob('YW5kcmV3Lmoud29uZ0BzdHVkZW50LnVuc3cuZWR1LmF1'))</script></p>
</sub></section>
</div>
</div>
<script type=text/javascript src=../../reveal-hugo/object-assign.js></script>
<a href=../../reveal-js/css/print/ id=print-location style=display:none></a>
<script type=text/javascript>var printLocationElement=document.getElementById('print-location'),link=document.createElement('link');link.rel='stylesheet',link.type='text/css',link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?'pdf.css':'paper.css'),document.getElementsByTagName('head')[0].appendChild(link)</script>
<script type=application/json id=reveal-hugo-site-params>{"center":false,"custom_theme":"presentations/theme.scss","custom_theme_compile":true,"dependencies":[{"src":"../plugins/capsLockKeymod.js"}],"history":true,"pdf_separate_fragments":true,"slide_number":true,"width":1024}</script>
<script type=application/json id=reveal-hugo-page-params>null</script>
<script src=../../reveal-js/js/reveal.js></script>
<script type=text/javascript>var revealHugoDefaults,revealHugoSiteParams,revealHugoPageParams,options;function camelize(a){return a&&Object.keys(a).forEach(function(b){newK=b.replace(/(\_\w)/g,function(a){return a[1].toUpperCase()}),newK!=b&&(a[newK]=a[b],delete a[b])}),a}revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML),revealHugoPageParams=JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams)),Reveal.initialize(options)</script>
<script type=text/javascript src=../../reveal-js/plugin/markdown/marked.js></script>
<script type=text/javascript src=../../reveal-js/plugin/markdown/markdown.js></script>
<script type=text/javascript src=../../reveal-js/plugin/highlight/highlight.js></script>
<script type=text/javascript src=../../reveal-js/plugin/zoom-js/zoom.js></script>
<script type=text/javascript src=../../reveal-js/plugin/notes/notes.js></script>
<script type=text/javascript>for(let a of document.querySelectorAll(".reveal .slides > section"))a.dataset.transition||(a.dataset.transition="fade-out slide-in");document.querySelectorAll('p img').forEach(b=>{if(b.alt!='center')return;let a=b;while(a.tagName!='P')a=a.parentNode;a.style.textAlign='center'})</script>
</body>
</html>